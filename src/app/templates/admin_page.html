<!DOCTYPE html>
{# 
	This is a Jinja2 template for an html page
	These lines are comments and are removed when the template is rendered. 
#}
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Blog of Blake Senftner</title>
  <link rel="stylesheet" href="/static/index.css">
</head>
<body>
	<div class="grid">
		{% include 'common_header.html' %}

		{# the left sidebar #}
		{% include 'common_lsidebar.html' %}

		<main>
			<div id="mainContent">
                <h4>Account & Admin Settings for {{ data.username }}</h4>
				
				<input type="checkbox" name="protect_contact" id="protect_contact" class="chkbox" />
        		<label for="protect_contact" class="chkbox">Require verified account for Contact page</label>

				<div id="adminMsg"></div>
                <br/>
                <a href="#" class="button" onclick="SaveAdminSettings()">Save Admin Settings</a>
  				
				{% include 'common_settings.html' %}

			</div>
		</main>

		<aside>
			<div id="aside">
				<a href="#" class="button" onclick="Logout()">Logout</a>
			</div>
		</aside>
  
	<footer>
		{{ frags[0].footer | safe }} 
	</footer>
	</div>
	
	{% include 'common_ifAccessDo.html' %}

	<script>
		
		document.addEventListener( "DOMContentLoaded", function(){page_init();} );
		//
		function page_init_work() {
			var state = "{{ data.protect_contact }}"
			state = (state=="True")
			document.getElementById("protect_contact").checked = state;
		}
		//
		function page_init() {
			ifAccessDo(page_init_work);
		}

		function SaveAdminSettingsWork() {
			
			// get admin settings:
			const protectContent = document.getElementById("protect_contact").checked;
                		
			// package as "note"
			const someData = {
				"title": "protect_contact", 
				"description": "configuration data for admins", 
				"data": JSON.stringify({ "protect_contact": protectContent }) ,
			}
			
			const options = {
				method: 'PUT', // Method itself
				headers: {
						 'Content-type': 'application/json; charset=UTF-8', // Indicates the content 
						 // "Authorization": "Bearer " + access_token // only needed when JWT is not in cookie
				},
				body: JSON.stringify(someData) // We send data in JSON format
			}

			fetch( '/notes/1/', options )
					.then( response => response.json() )
					.then( response => {
						// Do something with response.
						console.log( response )
						document.getElementById("adminMsg").innerHTML = 
							'<p>Admin Settings saved.</p>';
					}
				); 
		}
		function SaveAdminSettings() {
			ifAccessDo(SaveAdminSettingsWork);
		}

	</script>

	{% include 'common_settings2.html' %}

	{% include 'common_logout.html' %}


</body>
</html>
