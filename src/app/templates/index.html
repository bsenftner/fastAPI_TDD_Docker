<!DOCTYPE html>
{# 
	This is a Jinja2 template for an html page
	These lines are comments and are removed when the template is rendered. 
#}
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Blog of Blake Senftner</title>
  <link rel="stylesheet" href="/static/index.css">
</head>
<body>
	<div class="grid">
		<header>
			{{ frags[0].header | safe }}
		</header>

		{# the left sidebar #}
		<nav>
			{# default links from page_frags.py #}
			{% for alink in frags[0].links %} 
				{{ alink | safe }}
			{% endfor %}

			{# not expecting a huge number of blog posts, so here's all of them #}
			{% for post in blogPosts %} 
				<br/><br/><a href="/blog/{{ post.id }}">{{ post.title }}</a>
			{% endfor %}
		</nav>

		{# the main content area #}
		<main>
			<div id="mainContent">
				{# title and post contents, with an optional edit button #}
				<H1> {{contentPost.title}} </H1>
				{{contentPost.description | safe}}
			</div>
			
		</main>

		{# the right sidebar #}
		<aside>
			<div id="aside">
				<a href="#" class="button" onclick="Login()">Login</a>
			</div>
		</aside>
  
	<footer>
		{{ frags[0].footer | safe }} 
	</footer>
	</div>

	<script>
		
		document.addEventListener("DOMContentLoaded", function() {
			page_init();
		  });
		function page_init() {
			const access_token = localStorage.getItem('token');
			if (access_token) {
				const options = { headers: { "Authorization": "Bearer " + access_token } }
				fetch("/users/me", options)
				.then(response => response.json())
				.then( response => 
					{
						console.log(response)
						if (response.hasOwnProperty('username')) {

							document.getElementById("mainContent").innerHTML += 
								'<a href="#" class="button" onclick="BlogEdit()">Edit</a>';

							document.getElementById("aside").innerHTML = 
								'<a href="#" class="button" onclick="Logout()">Logout</a>';
						}
				  })
			}
		}

		function BlogEdit() { window.location.href = "/Editor/{{ contentPost.id }}"; }

		function Login() { window.location.href = "/login"; }

		function Logout() { 
			localStorage.removeItem('token');
			window.location.href = "/login"; 
		}

	</script>
</body>
</html>
